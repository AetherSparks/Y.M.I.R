<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Binaural Beats Session | Y.M.I.R AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="bg-black text-white font-primary overflow-x-hidden">
    <!-- Include Header -->
    {% include 'header.html' %}

    <!-- Main Content -->
    <main class="min-h-screen pt-20">
        <!-- Session Header -->
        <section class="py-12 px-6">
            <div class="max-w-4xl mx-auto">
                <!-- Back Navigation -->
                <div class="mb-8">
                    <a href="/experimental" class="inline-flex items-center text-blue-400 hover:text-blue-300 transition-colors">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                        </svg>
                        Back to Experimental Home
                    </a>
                </div>

                <!-- Session Info -->
                <div class="text-center mb-12">
                    <h1 class="text-4xl md:text-5xl font-bold mb-4">
                        <span class="bg-gradient-to-r from-blue-400 to-cyan-400 bg-clip-text text-transparent">
                            Binaural Beats Session
                        </span>
                    </h1>
                    <div id="goalDisplay" class="text-xl text-gray-300 mb-6">
                        <!-- Goal will be populated by JavaScript -->
                    </div>
                    
                    <!-- Headphones Requirement -->
                    <div class="bg-gradient-to-r from-blue-900/40 to-cyan-900/40 backdrop-blur-lg border border-blue-500/30 rounded-2xl p-6 max-w-2xl mx-auto">
                        <div class="flex items-center justify-center space-x-4">
                            <div class="text-3xl">ðŸŽ§</div>
                            <div class="text-left">
                                <h3 class="text-lg font-semibold text-blue-300">Headphones Required</h3>
                                <p class="text-gray-300 text-sm">
                                    Binaural beats require stereo headphones to work properly. Each ear receives a slightly different frequency.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Session Control Panel -->
        <section class="py-8 px-6">
            <div class="max-w-4xl mx-auto">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Control Panel -->
                    <div class="card-primary">
                        <h2 class="text-2xl font-bold mb-6 text-center text-blue-300">Session Controls</h2>
                        
                        <!-- Timer Display -->
                        <div class="text-center mb-8">
                            <div class="bg-gradient-to-r from-blue-900/40 to-purple-900/40 rounded-2xl p-8 mb-6">
                                <div id="timer" class="text-5xl font-mono font-bold text-white mb-2">25:00</div>
                                <div class="text-gray-400 text-sm">Session Time Remaining</div>
                            </div>
                            
                            <!-- Time Presets -->
                            <div class="grid grid-cols-4 gap-2 mb-6">
                                <button class="time-preset btn-secondary text-sm py-2" data-time="5">5 min</button>
                                <button class="time-preset btn-secondary text-sm py-2" data-time="15">15 min</button>
                                <button class="time-preset btn-secondary text-sm py-2 selected" data-time="25">25 min</button>
                                <button class="time-preset btn-secondary text-sm py-2" data-time="45">45 min</button>
                            </div>
                        </div>

                        <!-- Session Controls -->
                        <div class="space-y-4">
                            <button id="startBtn" class="btn-primary w-full py-4 text-lg font-semibold">
                                Start Session
                            </button>
                            <button id="pauseBtn" class="btn-secondary w-full py-4 text-lg font-semibold hidden">
                                Pause Session
                            </button>
                            <button id="stopBtn" class="btn-danger w-full py-3 text-lg hidden">
                                Stop Session
                            </button>
                        </div>

                        <!-- Volume Control -->
                        <div class="mt-8">
                            <label class="block text-sm font-medium text-gray-300 mb-3">Volume</label>
                            <div class="flex items-center space-x-4">
                                <span class="text-2xl">ðŸ”ˆ</span>
                                <input type="range" id="volumeSlider" min="0" max="100" value="50" 
                                       class="flex-1 h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer">
                                <span class="text-2xl">ðŸ”Š</span>
                            </div>
                            <div class="text-center mt-2">
                                <span id="volumeDisplay" class="text-sm text-gray-400">Volume: 50%</span>
                            </div>
                        </div>
                    </div>

                    <!-- Frequency Info Panel -->
                    <div class="card-primary">
                        <h2 class="text-2xl font-bold mb-6 text-center text-purple-300">Frequency Information</h2>
                        
                        <!-- Current Frequency Display -->
                        <div class="bg-gradient-to-r from-purple-900/40 to-blue-900/40 rounded-2xl p-6 mb-6">
                            <div class="text-center">
                                <div id="currentFreq" class="text-3xl font-bold text-white mb-2">10.0 Hz</div>
                                <div id="freqType" class="text-purple-300 font-semibold">Alpha Waves</div>
                                <div class="text-gray-400 text-sm mt-2">Target Brainwave Frequency</div>
                            </div>
                        </div>

                        <!-- Frequency Details -->
                        <div id="frequencyDetails" class="space-y-4">
                            <!-- Will be populated by JavaScript based on goal -->
                        </div>

                        <!-- Audio Settings -->
                        <div class="mt-6 space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Base Frequency</label>
                                <select id="baseFreqSelect" class="w-full bg-gray-800 border border-gray-600 rounded-lg px-3 py-2 text-white">
                                    <option value="200">200 Hz (Low)</option>
                                    <option value="250" selected>250 Hz (Medium)</option>
                                    <option value="300">300 Hz (High)</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Session Mode</label>
                                <select id="sessionMode" class="w-full bg-gray-800 border border-gray-600 rounded-lg px-3 py-2 text-white">
                                    <option value="constant">Constant Frequency</option>
                                    <option value="ramp">Gradual Ramp</option>
                                    <option value="progressive">Progressive Deepening</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Session Status -->
                <div class="mt-8">
                    <div class="card-glass">
                        <div class="flex items-center justify-center space-x-6">
                            <div class="flex items-center space-x-2">
                                <div id="statusIndicator" class="w-3 h-3 rounded-full bg-gray-500"></div>
                                <span id="statusText" class="text-gray-300">Ready to Begin</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <div class="text-xl">ðŸŽµ</div>
                                <span id="audioStatus" class="text-gray-400">Audio: Not Playing</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Progress Visualization -->
        <section class="py-8 px-6">
            <div class="max-w-4xl mx-auto">
                <div class="card-primary">
                    <h3 class="text-xl font-bold mb-6 text-center text-cyan-300">Session Progress</h3>
                    
                    <!-- Progress Bar -->
                    <div class="mb-6">
                        <div class="w-full bg-gray-700 rounded-full h-3">
                            <div id="progressBar" class="bg-gradient-to-r from-blue-500 to-cyan-500 h-3 rounded-full transition-all duration-1000" style="width: 0%"></div>
                        </div>
                        <div class="flex justify-between text-sm text-gray-400 mt-2">
                            <span>Start</span>
                            <span id="progressPercent">0%</span>
                            <span>Complete</span>
                        </div>
                    </div>

                    <!-- Pre/Post Session Questions (Hidden initially) -->
                    <div id="preSessionQuestions" class="hidden">
                        <h4 class="text-lg font-semibold mb-4 text-blue-300">Pre-Session Assessment</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Current Stress Level (1-10)</label>
                                <input type="range" id="preStress" min="1" max="10" value="5" class="w-full">
                                <div class="text-center mt-1 text-sm text-gray-400">Level: <span id="preStressValue">5</span></div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Current Focus Level (1-10)</label>
                                <input type="range" id="preFocus" min="1" max="10" value="5" class="w-full">
                                <div class="text-center mt-1 text-sm text-gray-400">Level: <span id="preFocusValue">5</span></div>
                            </div>
                        </div>
                    </div>

                    <div id="postSessionQuestions" class="hidden">
                        <h4 class="text-lg font-semibold mb-4 text-green-300">Post-Session Assessment</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Stress Level After Session (1-10)</label>
                                <input type="range" id="postStress" min="1" max="10" value="5" class="w-full">
                                <div class="text-center mt-1 text-sm text-gray-400">Level: <span id="postStressValue">5</span></div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Focus Level After Session (1-10)</label>
                                <input type="range" id="postFocus" min="1" max="10" value="5" class="w-full">
                                <div class="text-center mt-1 text-sm text-gray-400">Level: <span id="postFocusValue">5</span></div>
                            </div>
                        </div>
                        <div class="mt-6 text-center">
                            <button id="submitAssessment" class="btn-primary">Submit Assessment</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Hidden Audio Element -->
        <audio id="binauralAudio" loop>
            <source src="/static/audio/binaural_sample.mp3" type="audio/mpeg">
            Your browser does not support the audio element.
        </audio>
    </main>

    <!-- Include Footer -->
    {% include 'footer.html' %}

    <style>
        /* Y.M.I.R Theme Integration */
        :root {
            --primary-blue: #4070ff;
            --primary-cyan: #00d4ff;
            --bg-primary: #0c0c0c;
            --text-primary: #f0f0f0;
            --font-primary: 'Inter', 'Poppins', sans-serif;
        }

        body {
            font-family: var(--font-primary);
            background: linear-gradient(125deg, #000000, #0f172a, #1e293b);
        }

        /* Card System */
        .card-primary {
            background: rgba(30, 30, 30, 0.8);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(100, 100, 255, 0.2);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            padding: 24px;
            transition: all 0.3s ease;
        }

        .card-glass {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
            padding: 16px;
        }

        /* Button System */
        .btn-primary {
            background: linear-gradient(45deg, #4070ff, #00d4ff);
            border: none;
            border-radius: 12px;
            color: white;
            padding: 12px 24px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(64, 112, 255, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(64, 112, 255, 0.4);
        }

        .btn-secondary {
            background: rgba(30, 30, 30, 0.8);
            border: 1px solid rgba(64, 112, 255, 0.3);
            border-radius: 12px;
            color: #f0f0f0;
            padding: 8px 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(8px);
        }

        .btn-secondary:hover, .btn-secondary.selected {
            background: rgba(64, 112, 255, 0.2);
            border-color: rgba(64, 112, 255, 0.6);
        }

        .btn-danger {
            background: linear-gradient(45deg, #dc2626, #ef4444);
            border: none;
            border-radius: 12px;
            color: white;
            padding: 12px 24px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(220, 38, 38, 0.3);
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(220, 38, 38, 0.4);
        }

        /* Status Indicators */
        .status-ready { background-color: #6b7280; }
        .status-playing { background-color: #10b981; animation: pulse 2s infinite; }
        .status-paused { background-color: #f59e0b; }
        .status-stopped { background-color: #dc2626; }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Volume Slider Styling */
        input[type="range"] {
            background: transparent;
            cursor: pointer;
        }

        input[type="range"]::-webkit-slider-track {
            background: #374151;
            height: 8px;
            border-radius: 4px;
        }

        input[type="range"]::-webkit-slider-thumb {
            appearance: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: linear-gradient(45deg, #4070ff, #00d4ff);
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        }

        input[type="range"]::-moz-range-track {
            background: #374151;
            height: 8px;
            border-radius: 4px;
            border: none;
        }

        input[type="range"]::-moz-range-thumb {
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: linear-gradient(45deg, #4070ff, #00d4ff);
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        }
    </style>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Get goal from URL parameters
            const urlParams = new URLSearchParams(window.location.search);
            const goal = urlParams.get('goal') || 'focus';
            
            // Initialize session
            initializeSession(goal);
            
            // Session state
            let sessionActive = false;
            let sessionPaused = false;
            let sessionTimer = null;
            let currentTime = 1500; // 25 minutes default
            let totalTime = 1500;
            
            // Audio context for binaural beats generation
            let audioContext = null;
            let leftOscillator = null;
            let rightOscillator = null;
            let gainNode = null;
            
            // DOM elements
            const startBtn = document.getElementById('startBtn');
            const pauseBtn = document.getElementById('pauseBtn');
            const stopBtn = document.getElementById('stopBtn');
            const timer = document.getElementById('timer');
            const volumeSlider = document.getElementById('volumeSlider');
            const volumeDisplay = document.getElementById('volumeDisplay');
            const statusIndicator = document.getElementById('statusIndicator');
            const statusText = document.getElementById('statusText');
            const audioStatus = document.getElementById('audioStatus');
            const progressBar = document.getElementById('progressBar');
            const progressPercent = document.getElementById('progressPercent');
            
            // Event listeners
            startBtn.addEventListener('click', startSession);
            pauseBtn.addEventListener('click', pauseSession);
            stopBtn.addEventListener('click', stopSession);
            
            // Volume control
            volumeSlider.addEventListener('input', function() {
                const volume = this.value;
                volumeDisplay.textContent = `Volume: ${volume}%`;
                if (gainNode) {
                    gainNode.gain.value = volume / 100;
                }
            });
            
            // Time presets
            document.querySelectorAll('.time-preset').forEach(btn => {
                btn.addEventListener('click', function() {
                    if (!sessionActive) {
                        document.querySelectorAll('.time-preset').forEach(b => b.classList.remove('selected'));
                        this.classList.add('selected');
                        
                        const minutes = parseInt(this.dataset.time);
                        currentTime = minutes * 60;
                        totalTime = currentTime;
                        updateTimerDisplay();
                    }
                });
            });
            
            function initializeSession(goal) {
                // Set goal display
                const goalDisplay = document.getElementById('goalDisplay');
                const goalInfo = getGoalInfo(goal);
                goalDisplay.innerHTML = `
                    <div class="flex items-center justify-center space-x-3">
                        <span class="text-3xl">${goalInfo.emoji}</span>
                        <span class="text-2xl font-semibold">${goalInfo.name} Mode</span>
                    </div>
                `;
                
                // Set frequency information
                const currentFreq = document.getElementById('currentFreq');
                const freqType = document.getElementById('freqType');
                const frequencyDetails = document.getElementById('frequencyDetails');
                
                currentFreq.textContent = `${goalInfo.frequency} Hz`;
                freqType.textContent = goalInfo.waveType;
                
                frequencyDetails.innerHTML = `
                    <div class="bg-gradient-to-r from-gray-800/50 to-gray-700/50 rounded-lg p-4">
                        <h4 class="font-semibold text-white mb-2">Target Effects:</h4>
                        <ul class="text-sm text-gray-300 space-y-1">
                            ${goalInfo.effects.map(effect => `<li>â€¢ ${effect}</li>`).join('')}
                        </ul>
                    </div>
                    <div class="bg-gradient-to-r from-blue-900/30 to-purple-900/30 rounded-lg p-4">
                        <h4 class="font-semibold text-blue-200 mb-2">How It Works:</h4>
                        <p class="text-sm text-blue-100">${goalInfo.description}</p>
                    </div>
                `;
            }
            
            function getGoalInfo(goal) {
                const goalMap = {
                    sleep: {
                        name: 'Deep Sleep',
                        emoji: 'ðŸŒ™',
                        frequency: '2.0',
                        waveType: 'Delta Waves',
                        effects: ['Deep restorative sleep', 'Enhanced dream recall', 'Physical recovery', 'Immune system boost'],
                        description: 'Delta waves (0.5-4Hz) are the slowest brainwaves associated with deep, dreamless sleep and physical restoration.'
                    },
                    focus: {
                        name: 'Enhanced Focus',
                        emoji: 'ðŸŽ¯',
                        frequency: '20.0',
                        waveType: 'Beta Waves',
                        effects: ['Improved concentration', 'Enhanced mental clarity', 'Better problem solving', 'Increased alertness'],
                        description: 'Beta waves (13-30Hz) are associated with focused attention, analytical thinking, and active concentration.'
                    },
                    anxiety: {
                        name: 'Anxiety Relief',
                        emoji: 'ðŸ•Šï¸',
                        frequency: '10.0',
                        waveType: 'Alpha Waves',
                        effects: ['Reduced anxiety', 'Calmer mind', 'Stress relief', 'Emotional balance'],
                        description: 'Alpha waves (8-12Hz) promote a relaxed yet alert state, helping to reduce anxiety and stress.'
                    },
                    relaxation: {
                        name: 'Deep Relaxation',
                        emoji: 'ðŸ§˜',
                        frequency: '6.0',
                        waveType: 'Theta Waves',
                        effects: ['Deep relaxation', 'Meditation state', 'Inner peace', 'Stress reduction'],
                        description: 'Theta waves (4-8Hz) are associated with deep meditation, relaxation, and the subconscious mind.'
                    },
                    stress: {
                        name: 'Stress Reduction',
                        emoji: 'âš¡',
                        frequency: '8.0',
                        waveType: 'Alpha Waves',
                        effects: ['Lower cortisol levels', 'Reduced tension', 'Emotional balance', 'Mental calm'],
                        description: 'Alpha waves help activate the parasympathetic nervous system, promoting rest and recovery.'
                    },
                    creativity: {
                        name: 'Creative Flow',
                        emoji: 'ðŸŽ¨',
                        frequency: '6.0',
                        waveType: 'Theta Waves',
                        effects: ['Enhanced creativity', 'Artistic inspiration', 'Flow state', 'Innovative thinking'],
                        description: 'Theta waves are linked to creative insights, artistic inspiration, and the flow state.'
                    }
                };
                
                return goalMap[goal] || goalMap.focus;
            }
            
            async function startSession() {
                if (!sessionActive) {
                    // Show pre-session questions
                    document.getElementById('preSessionQuestions').classList.remove('hidden');
                    
                    // Initialize Web Audio API
                    try {
                        audioContext = new (window.AudioContext || window.webkitAudioContext)();
                        await createBinauralBeats();
                        
                        sessionActive = true;
                        sessionPaused = false;
                        
                        // Update UI
                        startBtn.classList.add('hidden');
                        pauseBtn.classList.remove('hidden');
                        stopBtn.classList.remove('hidden');
                        
                        updateStatus('playing', 'Session Active');
                        audioStatus.textContent = 'Audio: Binaural Beats Playing';
                        
                        // Start timer
                        sessionTimer = setInterval(updateTimer, 1000);
                        
                    } catch (error) {
                        console.error('Failed to start audio:', error);
                        alert('Failed to start audio. Please check your browser settings.');
                    }
                } else if (sessionPaused) {
                    // Resume
                    audioContext.resume();
                    sessionPaused = false;
                    
                    pauseBtn.textContent = 'Pause Session';
                    updateStatus('playing', 'Session Active');
                    sessionTimer = setInterval(updateTimer, 1000);
                }
            }
            
            function pauseSession() {
                if (sessionActive && !sessionPaused) {
                    audioContext.suspend();
                    sessionPaused = true;
                    
                    pauseBtn.textContent = 'Resume Session';
                    updateStatus('paused', 'Session Paused');
                    clearInterval(sessionTimer);
                }
            }
            
            function stopSession() {
                sessionActive = false;
                sessionPaused = false;
                
                // Stop audio
                if (audioContext) {
                    audioContext.close();
                    audioContext = null;
                }
                
                // Reset UI
                startBtn.classList.remove('hidden');
                pauseBtn.classList.add('hidden');
                stopBtn.classList.add('hidden');
                pauseBtn.textContent = 'Pause Session';
                
                updateStatus('stopped', 'Session Stopped');
                audioStatus.textContent = 'Audio: Not Playing';
                
                // Clear timer
                clearInterval(sessionTimer);
                
                // Show post-session questions
                document.getElementById('postSessionQuestions').classList.remove('hidden');
                
                // Reset timer
                currentTime = totalTime;
                updateTimerDisplay();
                updateProgress();
            }
            
            async function createBinauralBeats() {
                const goalInfo = getGoalInfo(new URLSearchParams(window.location.search).get('goal') || 'focus');
                const baseFreq = parseInt(document.getElementById('baseFreqSelect').value);
                const beatFreq = parseFloat(goalInfo.frequency);
                
                // Create oscillators
                leftOscillator = audioContext.createOscillator();
                rightOscillator = audioContext.createOscillator();
                
                // Create gain node for volume control
                gainNode = audioContext.createGain();
                gainNode.gain.value = volumeSlider.value / 100;
                
                // Create stereo panner for left and right channels
                const leftPanner = audioContext.createStereoPanner();
                const rightPanner = audioContext.createStereoPanner();
                leftPanner.pan.value = -1; // Full left
                rightPanner.pan.value = 1;  // Full right
                
                // Set frequencies
                leftOscillator.frequency.value = baseFreq;
                rightOscillator.frequency.value = baseFreq + beatFreq;
                
                // Set waveform (sine wave for smooth tones)
                leftOscillator.type = 'sine';
                rightOscillator.type = 'sine';
                
                // Connect audio graph
                leftOscillator.connect(leftPanner);
                rightOscillator.connect(rightPanner);
                leftPanner.connect(gainNode);
                rightPanner.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                // Start oscillators
                leftOscillator.start();
                rightOscillator.start();
            }
            
            function updateTimer() {
                if (currentTime > 0) {
                    currentTime--;
                    updateTimerDisplay();
                    updateProgress();
                } else {
                    // Session complete
                    stopSession();
                    alert('Session completed! Please complete the post-session assessment.');
                }
            }
            
            function updateTimerDisplay() {
                const minutes = Math.floor(currentTime / 60);
                const seconds = currentTime % 60;
                timer.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
            
            function updateProgress() {
                const progress = ((totalTime - currentTime) / totalTime) * 100;
                progressBar.style.width = `${progress}%`;
                progressPercent.textContent = `${Math.round(progress)}%`;
            }
            
            function updateStatus(status, text) {
                statusIndicator.className = `w-3 h-3 rounded-full status-${status}`;
                statusText.textContent = text;
            }
            
            // Assessment slider handlers
            document.getElementById('preStress').addEventListener('input', function() {
                document.getElementById('preStressValue').textContent = this.value;
            });
            
            document.getElementById('preFocus').addEventListener('input', function() {
                document.getElementById('preFocusValue').textContent = this.value;
            });
            
            document.getElementById('postStress').addEventListener('input', function() {
                document.getElementById('postStressValue').textContent = this.value;
            });
            
            document.getElementById('postFocus').addEventListener('input', function() {
                document.getElementById('postFocusValue').textContent = this.value;
            });
            
            document.getElementById('submitAssessment').addEventListener('click', function() {
                // Collect assessment data
                const assessmentData = {
                    goal: new URLSearchParams(window.location.search).get('goal'),
                    sessionType: 'binaural',
                    preStress: document.getElementById('preStress').value,
                    preFocus: document.getElementById('preFocus').value,
                    postStress: document.getElementById('postStress').value,
                    postFocus: document.getElementById('postFocus').value,
                    sessionDuration: totalTime,
                    completedAt: new Date().toISOString()
                };
                
                // Save to localStorage (can be sent to backend later)
                const sessions = JSON.parse(localStorage.getItem('ymirSessions') || '[]');
                sessions.push(assessmentData);
                localStorage.setItem('ymirSessions', JSON.stringify(sessions));
                
                alert('Assessment submitted! Thank you for your feedback.');
                
                // Hide assessment
                document.getElementById('postSessionQuestions').classList.add('hidden');
            });
            
            // Initialize timer display
            updateTimerDisplay();
        });
    </script>
    
    <!-- Firebase Authentication -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/auth-styles.css') }}">
    <script src="{{ url_for('static', filename='js/firebase-auth.js') }}"></script>
    
</body>
</html>